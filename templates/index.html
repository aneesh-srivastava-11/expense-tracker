{% extends "base.html" %}
{% block content %}
<h2>All Expenses</h2>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Category</th>
      <th>Amount (‚Çπ)</th>
      <th>Date</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for e in expenses %}
    <tr>
      <td>{{ e.title }}</td>
      <td>{{ e.category or 'Other' }}</td>
      <td>{{ e.amount }}</td>
      <td>{{ e.date }}</td>
      <td>
        <!-- Use e._id|string to correctly pass ObjectId in URL -->
        <a href="/edit/{{ e._id|string }}">‚úèÔ∏è</a>
        <a href="/delete/{{ e._id|string }}" onclick="return confirm('Delete this expense?')">üóëÔ∏è</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h3 class="total">Total Expenses: ‚Çπ{{ total }}</h3>

<h3>üìä Category-wise Chart</h3>
<canvas id="expenseChart" height="120"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('expenseChart');
new Chart(ctx, {
    type: 'bar',
    data: {
        labels: {{ categories|tojson }},
        datasets: [{
            label: 'Total per Category (‚Çπ)',
            data: {{ totals|tojson }},
            backgroundColor: '#00b894'
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>
{% endblock %}
